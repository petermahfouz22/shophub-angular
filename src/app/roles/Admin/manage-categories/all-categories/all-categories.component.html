<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-8 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Categories</h1>
      <p class="text-gray-600 mt-2">Manage and filter your categories</p>
    </div>
    <button routerLink="/admin/categories/create" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700">
      + Add Category
    </button>
  </div>

  <!-- Filters -->
  <div class="bg-white p-5 rounded-lg shadow-sm mb-6 grid md:grid-cols-3 gap-4">
    <!-- Search -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
      <div class="flex">
        <input type="text" [(ngModel)]="searchTerm" (input)="onSearch()" placeholder="Search categories..."
          class="border rounded p-2 w-full" />
      </div>
    </div>

    <!-- Status Filter -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
      <select [(ngModel)]="statusFilter" (change)="onFilterChange()"
        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">All</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>

    <!-- Parent Category Filter -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Parent Category</label>
      <select [(ngModel)]="parentFilter" (change)="onFilterChange()"
        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">All Categories</option>
        <option value="null">Main Categories Only</option>
        @for(category of parentCategories; track category.id){
        <option [value]="category.id">{{ category.name }}</option>
        }
      </select>
    </div>

    <!-- Count -->
    <div class="flex items-end">
      <p class="text-gray-600">Total: {{ totalItems }} categories</p>
    </div>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="bg-red-100 border border-red-300 text-red-700 p-3 rounded mb-4">
    {{ errorMessage }}
  </div>

  @if(isLoading){
  <app-loader />
  }

  <!-- Table -->
  <div *ngIf="!isLoading" class="bg-white shadow rounded-lg overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">
            Category
          </th>
          <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">
            Parent
          </th>
          <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">
            Subcategories
          </th>
          <!-- <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">
            Products
          </th> -->
          <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">
            Status
          </th>
          <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">
            Actions
          </th>
        </tr>
      </thead>

      <tbody class="bg-white divide-y divide-gray-200">
        @for(category of categories; track category.id){
        <tr class="hover:bg-gray-50">
          <!-- Category -->
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="h-10 w-10 bg-gray-100 flex items-center justify-center rounded-md overflow-hidden">
                <img *ngIf="category.image_url" [src]="getImageUrl(category.image_url)" alt="Category Image"
                  class="h-full w-full object-cover" />
                <span *ngIf="!category.image_url" class="text-gray-400 text-xs">No Img</span>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-900">
                  {{ category.name }}
                </div>
                <div class="text-sm text-gray-500">{{ category.slug }}</div>
                <div *ngIf="category.description" class="text-xs text-gray-400 truncate max-w-xs">
                  {{ category.description }}
                </div>
              </div>
            </div>
          </td>

          <!-- Parent Category -->
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-900">
              {{ category.parent?.name || 'â€”' }}
            </div>
          </td>

          <!-- Subcategories Count -->
          <td class="px-6 py-4 whitespace-nowrap">
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
              {{ category.children?.length || 0 }} subcategories
            </span>
          </td>

          <!-- Products Count -->
          <!-- <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
              {{ category.products_count || 0 }} products
            </span>
          </td> -->

          <!-- Status -->
          <td class="px-6 py-4 whitespace-nowrap">
            <span [ngClass]="getStatusBadgeClass(category.status)"
              class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
              {{ category.status }}
            </span>
          </td>

          <!-- Actions -->
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <div class="flex space-x-2">
              <!-- View -->
              <button [routerLink]="['/admin/categories', category.id]" class="text-blue-600 hover:text-blue-900">
                View
              </button>

              <!-- Edit -->
              <button [routerLink]="['edit', category.id]" class="text-green-600 hover:text-green-900">
                Edit
              </button>

              <!-- Toggle Status -->
              <button (click)="onToggleStatus(category)" [class]="category.status === 'active' 
          ? 'text-orange-600 hover:text-orange-900' 
          : 'text-green-600 hover:text-green-900'"
                [title]="category.status === 'active' ? 'Deactivate Category' : 'Activate Category'">
                {{ category.status === 'active' ? 'Deactivate' : 'Activate' }}
              </button>

              <!-- Delete -->
              <button (click)="onDelete(category)" class="text-red-600 hover:text-red-900">
                Delete
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>

    <!-- Empty state -->
    <div *ngIf="categories.length === 0" class="py-10 text-center text-gray-500">
      No categories found
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading && totalPages > 1" class="mt-6 flex justify-center space-x-2">
    <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1"
      class="px-3 py-1 border rounded text-gray-600 disabled:opacity-50">
      Prev
    </button>

    <button *ngFor="let page of getPages()" (click)="onPageChange(page)" [ngClass]="{
        'bg-blue-600 text-white': page === currentPage,
        'border border-gray-300 text-gray-600': page !== currentPage
      }" class="px-3 py-1 rounded">
      {{ page }}
    </button>

    <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages"
      class="px-3 py-1 border rounded text-gray-600 disabled:opacity-50">
      Next
    </button>
  </div>
</div>